<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta property="og:title" content="Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ù…Ø¬Ø§Ù†ÙŠ ÙÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± | Algerie-Market" />
<meta property="og:description" content="Ø£Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ù…Ø¬Ø§Ù†Ø§Ù‹ ÙÙŠ ÙƒÙ„ ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±" />
<meta property="og:image" content="https://algerie-market.github.io/market-algerie/og-image.jpg" />
<meta property="og:url" content="https://algerie-market.github.io/market-algerie/" />
<meta property="og:type" content="website" />
<meta name="google-site-verification" content="LBwDdBzuSqUSlG5ye_63PKx07Sbe_zv9GOeOAESYYPY" />
  <meta charset="UTF-8">
  <link rel="icon" type="image/png" href="favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Algerie-Market | Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ù…Ø¬Ø§Ù†ÙŠ ÙÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</title>
  <meta name="description" content="Ù…Ù†ØµØ© Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ù…Ø¬Ø§Ù†ÙŠØ© ÙÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± - Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ø³ÙŠØ§Ø±Ø§ØªØŒ Ø¹Ù‚Ø§Ø±Ø§ØªØŒ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª ÙÙŠ ÙƒÙ„ ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±">
  <meta name="keywords" content="Ø³ÙˆÙ‚ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±, Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±, Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ù…Ø¬Ø§Ù†ÙŠ, Ø³ÙŠØ§Ø±Ø§Øª Ù„Ù„Ø¨ÙŠØ¹, Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±, souq algerie, algerie market">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="Algerie-Market | Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ù…Ø¬Ø§Ù†ÙŠ ÙÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±">
  <meta property="og:description" content="Ø£Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ù…Ø¬Ø§Ù†Ø§Ù‹ ÙÙŠ ÙƒÙ„ ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±">
  <meta property="og:type" content="website">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --orange: #FF6B00;
      --orange-light: #FF8C38;
      --gold: #FFB800;
      --dark: #0A0A0F;
      --dark2: #12121A;
      --dark3: #1A1A26;
      --dark4: #22223A;
      --text: #E8E8F0;
      --text-muted: #888899;
      --border: rgba(255,107,0,0.15);
      --card: rgba(26,26,38,0.98);
      --green: #25D366;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Cairo',sans-serif; background:var(--dark); color:var(--text); min-height:100vh; overflow-x:hidden; }
    ::-webkit-scrollbar{width:5px} ::-webkit-scrollbar-track{background:var(--dark2)} ::-webkit-scrollbar-thumb{background:var(--orange);border-radius:3px}
    nav { position:sticky; top:0; z-index:100; background:rgba(10,10,15,0.97); backdrop-filter:blur(20px); border-bottom:1px solid var(--border); padding:0 16px; height:60px; display:flex; align-items:center; justify-content:space-between; }
    .nav-logo { font-size:20px; font-weight:900; color:var(--orange); cursor:pointer; }
    .nav-logo span { color:var(--gold); }
    .nav-actions { display:flex; gap:8px; align-items:center; }
    .btn { padding:8px 16px; border-radius:10px; font-family:'Cairo',sans-serif; font-weight:700; font-size:13px; cursor:pointer; border:none; transition:all 0.2s; }
    .btn-outline { background:transparent; border:1px solid var(--border); color:var(--text); }
    .btn-outline:hover { border-color:var(--orange); color:var(--orange); }
    .btn-primary { background:linear-gradient(135deg,var(--orange),var(--orange-light)); color:white; box-shadow:0 4px 15px rgba(255,107,0,0.3); }
    .btn-primary:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(255,107,0,0.4); }
    .btn-primary:disabled { opacity:0.6; cursor:not-allowed; transform:none; }
    .page { display:none; animation:fadeIn 0.3s ease; }
    .page.active { display:block; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
    .hero { text-align:center; padding:60px 16px 40px; }
    .hero-badge { display:inline-flex; align-items:center; gap:8px; background:rgba(255,107,0,0.1); border:1px solid rgba(255,107,0,0.3); padding:5px 14px; border-radius:50px; font-size:12px; color:var(--orange-light); margin-bottom:20px; }
    .hero h1 { font-size:clamp(28px,6vw,50px); font-weight:900; line-height:1.2; margin-bottom:10px; }
    .hero h1 .highlight { color:var(--orange); }
    .hero p { color:var(--text-muted); font-size:14px; margin-bottom:28px; }
    .search-box { max-width:560px; margin:0 auto 40px; position:relative; }
    .search-box input { width:100%; padding:14px 50px 14px 20px; background:var(--dark3); border:1px solid var(--border); border-radius:14px; color:var(--text); font-family:'Cairo',sans-serif; font-size:14px; outline:none; transition:border-color 0.2s; }
    .search-box input:focus { border-color:var(--orange); }
    .search-box input::placeholder { color:var(--text-muted); }
    .search-btn { position:absolute; left:8px; top:50%; transform:translateY(-50%); width:38px; height:38px; background:linear-gradient(135deg,var(--orange),var(--orange-light)); border:none; border-radius:10px; cursor:pointer; font-size:16px; }
    .stats { display:flex; justify-content:center; gap:32px; flex-wrap:wrap; margin-bottom:50px; }
    .stat { text-align:center; }
    .stat-num { font-size:26px; font-weight:900; color:var(--orange); }
    .stat-label { font-size:11px; color:var(--text-muted); }
    .section-title { text-align:center; margin-bottom:24px; }
    .section-title h2 { font-size:22px; font-weight:800; }
    .section-title .line { width:40px; height:3px; background:var(--orange); border-radius:2px; margin:8px auto 0; }
    .categories { padding:0 16px 50px; max-width:860px; margin:0 auto; }
    .cats-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; }
    .cat-card { background:var(--dark3); border:1px solid var(--border); border-radius:14px; padding:20px 8px; text-align:center; cursor:pointer; transition:all 0.25s; position:relative; overflow:hidden; }
    .cat-card::after { content:''; position:absolute; inset:0; background:linear-gradient(135deg,rgba(255,107,0,0.05),transparent); opacity:0; transition:opacity 0.2s; }
    .cat-card:hover { border-color:var(--orange); transform:translateY(-3px); box-shadow:0 8px 25px rgba(255,107,0,0.15); }
    .cat-card:hover::after { opacity:1; }
    .cat-icon { font-size:28px; margin-bottom:8px; }
    .cat-name { font-size:13px; font-weight:700; margin-bottom:4px; }
    .cat-count { font-size:11px; color:var(--orange); font-weight:600; }
    .cat-arrow { font-size:11px; color:var(--text-muted); margin-top:4px; }
    .cat-page-header { padding:20px 16px; max-width:1000px; margin:0 auto; display:flex; align-items:center; gap:12px; }
    .back-btn { display:flex; align-items:center; gap:6px; padding:8px 16px; background:var(--dark3); border:1px solid var(--border); border-radius:10px; cursor:pointer; font-family:'Cairo',sans-serif; font-size:13px; font-weight:700; color:var(--text); transition:all 0.2s; }
    .back-btn:hover { border-color:var(--orange); color:var(--orange); }
    .cat-page-title { font-size:20px; font-weight:900; display:flex; align-items:center; gap:8px; }
    .ads-section { padding:0 16px 60px; max-width:1000px; margin:0 auto; }
    .ads-filters { display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-bottom:24px; }
    .filter-btn { padding:7px 18px; border-radius:50px; border:1px solid var(--border); background:transparent; color:var(--text-muted); font-family:'Cairo',sans-serif; font-size:12px; cursor:pointer; transition:all 0.2s; }
    .filter-btn.active,.filter-btn:hover { background:var(--orange); border-color:var(--orange); color:white; }
    .ads-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:16px; }
    .ad-card { background:var(--card); border:1px solid var(--border); border-radius:14px; overflow:hidden; transition:all 0.25s; cursor:pointer; animation:fadeUp 0.4s ease both; }
    .ad-card:hover { transform:translateY(-4px); border-color:rgba(255,107,0,0.4); box-shadow:0 10px 30px rgba(0,0,0,0.4); }
    @keyframes fadeUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
    .ad-img { width:100%; height:170px; background:var(--dark4); display:flex; align-items:center; justify-content:center; font-size:44px; overflow:hidden; position:relative; }
    .ad-img img { width:100%; height:100%; object-fit:cover; }
    .ad-rating-badge { position:absolute; top:8px; right:8px; background:rgba(0,0,0,0.75); border-radius:20px; padding:3px 8px; font-size:11px; display:flex; align-items:center; gap:3px; }
    .ad-body { padding:12px; }
    .ad-type { display:inline-block; padding:2px 10px; border-radius:50px; font-size:10px; font-weight:700; margin-bottom:6px; }
    .type-sell { background:rgba(255,107,0,0.15); color:var(--orange); }
    .type-rent { background:rgba(255,184,0,0.15); color:var(--gold); }
    .type-wanted { background:rgba(100,200,200,0.15); color:#6cc; }
    .type-free { background:rgba(150,100,255,0.15); color:#a78bfa; }
    .ad-title { font-size:14px; font-weight:700; margin-bottom:5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .ad-price { font-size:17px; font-weight:900; color:var(--orange); margin-bottom:8px; }
    .ad-meta { display:flex; gap:10px; font-size:10px; color:var(--text-muted); }
    .empty-state { text-align:center; padding:60px 20px; color:var(--text-muted); grid-column:1/-1; }
    .empty-state .icon { font-size:56px; margin-bottom:12px; }
    .empty-state h3 { font-size:18px; margin-bottom:6px; color:var(--text); }
    .loading { text-align:center; padding:60px; grid-column:1/-1; }
    .spinner { width:36px; height:36px; border:3px solid var(--dark4); border-top-color:var(--orange); border-radius:50%; animation:spin 0.8s linear infinite; margin:0 auto 12px; }
    @keyframes spin { to{transform:rotate(360deg)} }
    .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.88); backdrop-filter:blur(8px); z-index:200; display:none; align-items:center; justify-content:center; padding:16px; }
    .modal-overlay.open { display:flex; }
    .modal { background:var(--dark2); border:1px solid var(--border); border-radius:20px; width:100%; max-width:520px; max-height:92vh; overflow-y:auto; padding:28px 24px; position:relative; animation:modalIn 0.3s ease; }
    @keyframes modalIn { from{opacity:0;transform:scale(0.92)} to{opacity:1;transform:scale(1)} }
    .modal-close { position:absolute; top:14px; left:14px; width:32px; height:32px; background:var(--dark4); border:none; border-radius:9px; color:var(--text); font-size:16px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
    .modal-close:hover { background:rgba(255,107,0,0.2); }
    .modal h2 { font-size:20px; font-weight:800; margin-bottom:20px; }
    .form-group { margin-bottom:16px; }
    .form-group label { display:block; font-size:12px; font-weight:700; color:var(--text-muted); margin-bottom:6px; }
    .form-group input,.form-group select,.form-group textarea { width:100%; padding:11px 14px; background:var(--dark3); border:1px solid var(--border); border-radius:11px; color:var(--text); font-family:'Cairo',sans-serif; font-size:13px; outline:none; transition:border-color 0.2s; }
    .form-group input:focus,.form-group select:focus,.form-group textarea:focus { border-color:var(--orange); }
    .form-group select option { background:var(--dark2); }
    .form-group textarea { resize:vertical; min-height:90px; }
    .form-row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .img-upload { border:2px dashed var(--border); border-radius:12px; padding:20px; text-align:center; cursor:pointer; transition:border-color 0.2s; }
    .img-upload:hover { border-color:var(--orange); }
    .img-upload input { display:none; }
    .img-upload p { font-size:13px; color:var(--text-muted); margin-top:6px; }
    .img-previews { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-top:10px; }
    .img-preview-item { aspect-ratio:1; border-radius:8px; overflow:hidden; position:relative; background:var(--dark4); }
    .img-preview-item img { width:100%; height:100%; object-fit:cover; }
    .img-preview-item button { position:absolute; top:3px; right:3px; width:18px; height:18px; background:rgba(0,0,0,0.75); border:none; border-radius:50%; color:white; font-size:11px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
    .auth-tabs { display:flex; background:var(--dark3); border-radius:11px; padding:3px; margin-bottom:20px; }
    .auth-tab { flex:1; padding:9px; text-align:center; border-radius:9px; cursor:pointer; font-weight:700; font-size:13px; transition:all 0.2s; color:var(--text-muted); }
    .auth-tab.active { background:var(--orange); color:white; }
    .ad-detail-img-main { width:100%; height:220px; background:var(--dark4); border-radius:12px; overflow:hidden; display:flex; align-items:center; justify-content:center; font-size:56px; margin-bottom:12px; }
    .ad-detail-img-main img { width:100%; height:100%; object-fit:cover; }
    .contact-btn { width:100%; padding:13px; background:linear-gradient(135deg,#25D366,#128C7E); color:white; border:none; border-radius:12px; font-family:'Cairo',sans-serif; font-size:14px; font-weight:700; cursor:pointer; margin-top:14px; display:flex; align-items:center; justify-content:center; gap:8px; }
    .detail-info { background:var(--dark3); border-radius:12px; padding:14px; margin-bottom:12px; }
    .detail-row { display:flex; justify-content:space-between; align-items:center; padding:6px 0; border-bottom:1px solid var(--border); font-size:13px; }
    .detail-row:last-child { border-bottom:none; }
    .detail-row .label { color:var(--text-muted); }
    .detail-row .value { font-weight:700; }
    .stars-row { display:flex; gap:4px; align-items:center; }
    .star { font-size:20px; cursor:pointer; transition:transform 0.1s; color:#444; }
    .star.active { color:var(--gold); }
    .star:hover { transform:scale(1.2); }
    .rating-display { display:flex; gap:3px; align-items:center; }
    .rating-display .star-sm { font-size:13px; color:var(--gold); }
    .rating-display .star-sm.empty { color:#444; }
    .comments-section { margin-top:16px; }
    .comments-section h4 { font-size:14px; font-weight:700; margin-bottom:12px; color:var(--text-muted); border-bottom:1px solid var(--border); padding-bottom:8px; }
    .comment-item { background:var(--dark3); border-radius:10px; padding:10px 12px; margin-bottom:8px; }
    .comment-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:5px; }
    .comment-author { font-size:12px; font-weight:700; color:var(--orange); }
    .comment-time { font-size:10px; color:var(--text-muted); }
    .comment-stars { color:var(--gold); font-size:13px; margin-bottom:4px; }
    .comment-text { font-size:12px; color:var(--text); line-height:1.6; }
    .add-comment-box { margin-top:12px; }
    .comment-input-row { display:flex; gap:8px; margin-top:8px; }
    .comment-input-row input { flex:1; padding:9px 12px; background:var(--dark3); border:1px solid var(--border); border-radius:10px; color:var(--text); font-family:'Cairo',sans-serif; font-size:12px; outline:none; }
    .comment-input-row input:focus { border-color:var(--orange); }
    .comment-input-row button { padding:9px 16px; background:var(--orange); border:none; border-radius:10px; color:white; font-family:'Cairo',sans-serif; font-size:12px; font-weight:700; cursor:pointer; white-space:nowrap; }
    .no-comments { text-align:center; color:var(--text-muted); font-size:12px; padding:16px; }
    .comments-loading { text-align:center; color:var(--text-muted); font-size:12px; padding:12px; }
    .user-badge { display:flex; align-items:center; gap:8px; }
    .user-avatar { width:32px; height:32px; background:linear-gradient(135deg,var(--orange),var(--gold)); border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:13px; color:white; flex-shrink:0; }
    .user-name { font-size:12px; font-weight:700; max-width:80px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .toast { position:fixed; bottom:20px; right:16px; left:16px; max-width:320px; margin:0 auto; background:var(--dark3); border:1px solid var(--border); border-radius:12px; padding:12px 18px; font-size:13px; font-weight:600; z-index:999; transform:translateY(100px); opacity:0; transition:all 0.3s; text-align:center; }
    .toast.show { transform:translateY(0); opacity:1; }
    .toast.success { border-color:rgba(100,200,100,0.4); color:#6ee7b7; }
    .toast.error { border-color:rgba(255,80,80,0.4); color:#fca5a5; }
    .my-ad-item { display:flex; align-items:center; gap:12px; padding:12px; background:var(--dark3); border-radius:12px; margin-bottom:10px; }
    .my-ad-thumb { width:50px; height:50px; border-radius:8px; background:var(--dark4); display:flex; align-items:center; justify-content:center; font-size:22px; overflow:hidden; flex-shrink:0; }
    .my-ad-thumb img { width:100%; height:100%; object-fit:cover; }
    .my-ad-info { flex:1; min-width:0; }
    .my-ad-title { font-size:13px; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .my-ad-price { font-size:12px; color:var(--orange); font-weight:700; }
    .btn-delete { padding:6px 12px; background:rgba(255,80,80,0.1); border:1px solid rgba(255,80,80,0.3); color:#fca5a5; border-radius:8px; font-family:'Cairo',sans-serif; font-size:11px; cursor:pointer; }
    .breadcrumb { padding:12px 16px 0; max-width:1000px; margin:0 auto; font-size:12px; color:var(--text-muted); display:flex; align-items:center; gap:6px; }
    .breadcrumb span { cursor:pointer; transition:color 0.2s; }
    .breadcrumb span:hover { color:var(--orange); }
    .breadcrumb .current { color:var(--text); font-weight:600; }
    footer { border-top:1px solid var(--border); padding:24px 16px; text-align:center; color:var(--text-muted); font-size:12px; }
    .footer-logo { font-size:18px; font-weight:900; color:var(--orange); margin-bottom:6px; }
    @media(max-width:500px){.cats-grid{grid-template-columns:repeat(3,1fr)}.form-row{grid-template-columns:1fr}.stats{gap:20px}}
    @media(max-width:360px){.cats-grid{grid-template-columns:repeat(2,1fr)}}
  </style>
</head>
<body>

<nav>
  <div class="nav-logo" onclick="goHome()">Algerie<span>-Market</span> ğŸ›’</div>
  <div class="nav-actions">
    <div id="guestButtons" style="display:flex;gap:8px">
      <button class="btn btn-outline" onclick="openModal('authModal')">Ø¯Ø®ÙˆÙ„</button>
      <button class="btn btn-primary" onclick="requireAuth()">+ Ø£Ø¶Ù Ø¥Ø¹Ù„Ø§Ù†</button>
    </div>
    <div id="userBadge" style="display:none">
      <div class="user-badge">
        <div class="user-avatar" id="userInitial">A</div>
        <div>
          <div class="user-name" id="userName"></div>
          <div style="font-size:10px;color:var(--text-muted);cursor:pointer" onclick="openMyAds()">Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ</div>
        </div>
        <button class="btn btn-outline" style="padding:5px 10px;font-size:11px" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
      </div>
    </div>
  </div>
</nav>

<!-- HOME PAGE -->
<div id="homePage" class="page active">
  <section class="hero">
    <div class="hero-badge">ğŸ‡©ğŸ‡¿ Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ù…Ø¬Ø§Ù†ÙŠ ÙÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</div>
    <h1>Ø§Ø¹Ø±Ø¶ Ù…Ù†ØªØ¬Ùƒ<br>ÙˆØ§Ø¨Ø¯Ø£ <span class="highlight">Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„Ø´Ø±Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</span></h1>
    <p>Ø¢Ù„Ø§Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙÙŠ ÙƒÙ„ ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ØŒ Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ù…Ø¬Ø§Ù†ÙŠ ÙˆØ¨Ø¯ÙˆÙ† Ø£ÙŠ Ø±Ø³ÙˆÙ…</p>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡... Ø³ÙŠØ§Ø±Ø§ØªØŒ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§ØªØŒ Ø¹Ù‚Ø§Ø±Ø§Øª..." oninput="doSearch()" onkeydown="if(event.key==='Enter')doSearch()">
      <button class="search-btn" onclick="doSearch()">ğŸ”</button>
    </div>
  </section>
  <div class="stats">
    <div class="stat"><div class="stat-num" id="statAds">...</div><div class="stat-label">Ø¥Ø¹Ù„Ø§Ù† Ù†Ø´Ø·</div></div>
    <div class="stat"><div class="stat-num" id="statUsers">...</div><div class="stat-label">Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„</div></div>
    <div class="stat"><div class="stat-num">58</div><div class="stat-label">ÙˆÙ„Ø§ÙŠØ© Ù…ØºØ·Ø§Ø©</div></div>
    <div class="stat"><div class="stat-num">Ù…Ø¬Ø§Ù†ÙŠ</div><div class="stat-label">100% Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ù…Ø¬Ø§Ù†ÙŠ</div></div>
  </div>
  <section class="categories">
    <div class="section-title"><h2>Ø§Ø®ØªØ± ÙØ¦Ø© Ù„Ù„ØªØµÙØ­</h2><div class="line"></div></div>
    <p style="text-align:center;color:var(--text-muted);font-size:12px;margin-bottom:20px">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ ÙØ¦Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù‡Ø§</p>
    <div class="cats-grid">
      <div class="cat-card" onclick="openCategory('Ø³ÙŠØ§Ø±Ø§Øª','ğŸš—')"><div class="cat-icon">ğŸš—</div><div class="cat-name">Ø³ÙŠØ§Ø±Ø§Øª</div><div class="cat-count" id="cnt-Ø³ÙŠØ§Ø±Ø§Øª">0 Ø¥Ø¹Ù„Ø§Ù†</div><div class="cat-arrow">â† ØªØµÙØ­</div></div>
      <div class="cat-card" onclick="openCategory('Ø¹Ù‚Ø§Ø±Ø§Øª','ğŸ ')"><div class="cat-icon">ğŸ </div><div class="cat-name">Ø¹Ù‚Ø§Ø±Ø§Øª</div><div class="cat-count" id="cnt-Ø¹Ù‚Ø§Ø±Ø§Øª">0 Ø¥Ø¹Ù„Ø§Ù†</div><div class="cat-arrow">â† ØªØµÙØ­</div></div>
      <div class="cat-card" onclick="openCategory('Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª','ğŸ“±')"><div class="cat-icon">ğŸ“±</div><div class="cat-name">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</div><div class="cat-count" id="cnt-Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª">0 Ø¥Ø¹Ù„Ø§Ù†</div><div class="cat-arrow">â† ØªØµÙØ­</div></div>
      <div class="cat-card" onclick="openCategory('Ù…Ù„Ø§Ø¨Ø³','ğŸ‘—')"><div class="cat-icon">ğŸ‘—</div><div class="cat-name">Ù…Ù„Ø§Ø¨Ø³</div><div class="cat-count" id="cnt-Ù…Ù„Ø§Ø¨Ø³">0 Ø¥Ø¹Ù„Ø§Ù†</div><div class="cat-arrow">â† ØªØµÙØ­</div></div>
      <div class="cat-card" onclick="openCategory('ÙˆØ¸Ø§Ø¦Ù','ğŸ’¼')"><div class="cat-icon">ğŸ’¼</div><div class="cat-name">ÙˆØ¸Ø§Ø¦Ù</div><div class="cat-count" id="cnt-ÙˆØ¸Ø§Ø¦Ù">0 Ø¥Ø¹Ù„Ø§Ù†</div><div class="cat-arrow">â† ØªØµÙØ­</div></div>
      <div class="cat-card" onclick="openCategory('Ø£Ø«Ø§Ø«','ğŸ›‹ï¸')"><div class="cat-icon">ğŸ›‹ï¸</div><div class="cat-name">Ø£Ø«Ø§Ø«</div><div class="cat-count" id="cnt-Ø£Ø«Ø§Ø«">0 Ø¥Ø¹Ù„Ø§Ù†</div><div class="cat-arrow">â† ØªØµÙØ­</div></div>
      <div class="cat-card" onclick="openCategory('Ø¯Ø±Ø§Ø¬Ø§Øª','ğŸï¸')"><div class="cat-icon">ğŸï¸</div><div class="cat-name">Ø¯Ø±Ø§Ø¬Ø§Øª</div><div class="cat-count" id="cnt-Ø¯Ø±Ø§Ø¬Ø§Øª">0 Ø¥Ø¹Ù„Ø§Ù†</div><div class="cat-arrow">â† ØªØµÙØ­</div></div>
      <div class="cat-card" onclick="openCategory('Ø®Ø¯Ù…Ø§Øª','ğŸ”§')"><div class="cat-icon">ğŸ”§</div><div class="cat-name">Ø®Ø¯Ù…Ø§Øª</div><div class="cat-count" id="cnt-Ø®Ø¯Ù…Ø§Øª">0 Ø¥Ø¹Ù„Ø§Ù†</div><div class="cat-arrow">â† ØªØµÙØ­</div></div>
      <div class="cat-card" onclick="openCategory('Ø­ÙŠÙˆØ§Ù†Ø§Øª','ğŸ¾')"><div class="cat-icon">ğŸ¾</div><div class="cat-name">Ø­ÙŠÙˆØ§Ù†Ø§Øª</div><div class="cat-count" id="cnt-Ø­ÙŠÙˆØ§Ù†Ø§Øª">0 Ø¥Ø¹Ù„Ø§Ù†</div><div class="cat-arrow">â† ØªØµÙØ­</div></div>
      <div class="cat-card" onclick="openCategory('Ø±ÙŠØ§Ø¶Ø©','âš½')"><div class="cat-icon">âš½</div><div class="cat-name">Ø±ÙŠØ§Ø¶Ø©</div><div class="cat-count" id="cnt-Ø±ÙŠØ§Ø¶Ø©">0 Ø¥Ø¹Ù„Ø§Ù†</div><div class="cat-arrow">â† ØªØµÙØ­</div></div>
      <div class="cat-card" onclick="openCategory('Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©','ğŸ¡')"><div class="cat-icon">ğŸ¡</div><div class="cat-name">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©</div><div class="cat-count" id="cnt-Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©">0 Ø¥Ø¹Ù„Ø§Ù†</div><div class="cat-arrow">â† ØªØµÙØ­</div></div>
      <div class="cat-card" onclick="openCategory('Ø£Ø®Ø±Ù‰','ğŸ“¦')"><div class="cat-icon">ğŸ“¦</div><div class="cat-name">Ø£Ø®Ø±Ù‰</div><div class="cat-count" id="cnt-Ø£Ø®Ø±Ù‰">0 Ø¥Ø¹Ù„Ø§Ù†</div><div class="cat-arrow">â† ØªØµÙØ­</div></div>
    </div>
  </section>
</div>

<!-- CATEGORY PAGE -->
<div id="categoryPage" class="page">
  <div class="breadcrumb">
    <span onclick="goHome()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    <span class="sep" style="color:var(--border)">â€º</span>
    <span class="current" id="breadcrumbCat">Ø§Ù„ÙØ¦Ø©</span>
  </div>
  <div class="cat-page-header">
    <button class="back-btn" onclick="goHome()">â† Ø±Ø¬ÙˆØ¹</button>
    <div class="cat-page-title" id="catPageTitle">Ø§Ù„ÙØ¦Ø©</div>
  </div>
  <section class="ads-section">
    <div class="ads-filters">
      <button class="filter-btn active" onclick="filterType('all',this)">Ø§Ù„ÙƒÙ„</button>
      <button class="filter-btn" onclick="filterType('Ù„Ù„Ø¨ÙŠØ¹',this)">Ù„Ù„Ø¨ÙŠØ¹</button>
      <button class="filter-btn" onclick="filterType('Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±',this)">Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±</button>
      <button class="filter-btn" onclick="filterType('Ù…Ø·Ù„ÙˆØ¨',this)">Ù…Ø·Ù„ÙˆØ¨</button>
      <button class="filter-btn" onclick="filterType('Ù…Ø¬Ø§Ù†ÙŠ',this)">Ù…Ø¬Ø§Ù†ÙŠ</button>
    </div>
    <div class="ads-grid" id="adsGrid"></div>
    <div style="text-align:center;margin-top:24px">
      <button class="btn btn-outline" id="loadMoreBtn" style="display:none" onclick="loadMore()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯</button>
    </div>
  </section>
</div>

<!-- SEARCH PAGE -->
<div id="searchPage" class="page">
  <div class="cat-page-header">
    <button class="back-btn" onclick="goHome()">â† Ø±Ø¬ÙˆØ¹</button>
    <div class="cat-page-title">ğŸ” Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</div>
  </div>
  <section class="ads-section">
    <div class="ads-grid" id="searchGrid"></div>
  </section>
</div>

<footer>
  <div class="footer-logo">Algerie-Market ğŸ›’</div>
  <p>Â© 2025 Algerie-Market - Ù…Ù†ØµØ© Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ù…Ø¬Ø§Ù†ÙŠ ÙÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± ğŸ‡©ğŸ‡¿</p>
</footer>

<div class="toast" id="toast"></div>

<!-- AUTH MODAL -->
<div class="modal-overlay" id="authModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('authModal')">âœ•</button>
    <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹</h2>
    <div class="auth-tabs">
      <div class="auth-tab active" onclick="switchAuthTab('login')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
      <div class="auth-tab" onclick="switchAuthTab('register')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</div>
    </div>
    <div id="loginForm">
      <div class="form-group"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><input type="email" id="loginEmail" placeholder="example@gmail.com"></div>
      <div class="form-group"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
      <button class="btn btn-primary" style="width:100%;padding:12px" onclick="doLogin()" id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
      <div style="margin-top:12px">
        <button onclick="doGoogleLogin()" style="width:100%;padding:11px;background:white;border:1px solid #ddd;border-radius:11px;font-family:'Cairo',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:#333;display:flex;align-items:center;justify-content:center;gap:8px">
          <span>ğŸ”µ</span> Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google
        </button>
      </div>
    </div>
    <div id="registerForm" style="display:none">
      <div class="form-group"><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label><input type="text" id="regName" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„"></div>
      <div class="form-group"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><input type="email" id="regEmail" placeholder="example@gmail.com"></div>
      <div class="form-group"><label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label><input type="tel" id="regPhone" placeholder="0xxxxxxxxx"></div>
      <div class="form-group"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><input type="password" id="regPass" placeholder="6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"></div>
      <button class="btn btn-primary" style="width:100%;padding:12px" onclick="doRegister()" id="registerBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
    </div>
  </div>
</div>

<!-- POST AD MODAL -->
<div class="modal-overlay" id="postModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('postModal')">âœ•</button>
    <h2>ğŸ“¢ Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</h2>
    <div class="form-group"><label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† *</label><input type="text" id="adTitle" placeholder="Ù…Ø«Ø§Ù„: iPhone 14 Pro Ù„Ù„Ø¨ÙŠØ¹"></div>
    <div class="form-row">
      <div class="form-group"><label>Ø§Ù„ÙØ¦Ø© *</label>
        <select id="adCat">
          <option value="">Ø§Ø®ØªØ± ÙØ¦Ø©</option>
          <option>Ø³ÙŠØ§Ø±Ø§Øª</option><option>Ø¹Ù‚Ø§Ø±Ø§Øª</option><option>Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
          <option>Ù…Ù„Ø§Ø¨Ø³</option><option>ÙˆØ¸Ø§Ø¦Ù</option><option>Ø£Ø«Ø§Ø«</option>
          <option>Ø¯Ø±Ø§Ø¬Ø§Øª</option><option>Ø®Ø¯Ù…Ø§Øª</option><option>Ø­ÙŠÙˆØ§Ù†Ø§Øª</option>
          <option>Ø±ÙŠØ§Ø¶Ø©</option><option>Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©</option><option>Ø£Ø®Ø±Ù‰</option>
        </select>
      </div>
      <div class="form-group"><label>Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† *</label>
        <select id="adType">
          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
          <option>Ù„Ù„Ø¨ÙŠØ¹</option><option>Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±</option><option>Ù…Ø·Ù„ÙˆØ¨</option><option>Ù…Ø¬Ø§Ù†ÙŠ</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Ø§Ù„Ø³Ø¹Ø± (Ø¯Ø¬)</label><input type="number" id="adPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¯ÙŠÙ†Ø§Ø±"></div>
      <div class="form-group"><label>Ø§Ù„ÙˆÙ„Ø§ÙŠØ© *</label>
        <select id="adWilaya">
          <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</option>
          <option>Ø£Ø¯Ø±Ø§Ø±</option><option>Ø§Ù„Ø´Ù„Ù</option><option>Ø§Ù„Ø£ØºÙˆØ§Ø·</option><option>Ø£Ù… Ø§Ù„Ø¨ÙˆØ§Ù‚ÙŠ</option>
          <option>Ø¨Ø§ØªÙ†Ø©</option><option>Ø¨Ø¬Ø§ÙŠØ©</option><option>Ø¨Ø³ÙƒØ±Ø©</option><option>Ø¨Ø´Ø§Ø±</option>
          <option>Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©</option><option>Ø§Ù„Ø¨ÙˆÙŠØ±Ø©</option><option>ØªÙ…Ù†Ø±Ø§Ø³Øª</option><option>ØªØ¨Ø³Ø©</option>
          <option>ØªÙ„Ù…Ø³Ø§Ù†</option><option>ØªÙŠØ§Ø±Øª</option><option>ØªÙŠØ²ÙŠ ÙˆØ²Ùˆ</option><option>Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©</option>
          <option>Ø§Ù„Ø¬Ù„ÙØ©</option><option>Ø¬ÙŠØ¬Ù„</option><option>Ø³Ø·ÙŠÙ</option><option>Ø³Ø¹ÙŠØ¯Ø©</option>
          <option>Ø³ÙƒÙŠÙƒØ¯Ø©</option><option>Ø³ÙŠØ¯ÙŠ Ø¨Ù„Ø¹Ø¨Ø§Ø³</option><option>Ø¹Ù†Ø§Ø¨Ø©</option><option>Ù‚Ø§Ù„Ù…Ø©</option>
          <option>Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©</option><option>Ø§Ù„Ù…Ø¯ÙŠØ©</option><option>Ù…Ø³ØªØºØ§Ù†Ù…</option><option>Ø§Ù„Ù…Ø³ÙŠÙ„Ø©</option>
          <option>Ù…Ø¹Ø³ÙƒØ±</option><option>ÙˆØ±Ù‚Ù„Ø©</option><option>ÙˆÙ‡Ø±Ø§Ù†</option><option>Ø§Ù„Ø¨ÙŠØ¶</option>
          <option>Ø¥Ù„ÙŠØ²ÙŠ</option><option>Ø¨Ø±Ø¬ Ø¨ÙˆØ¹Ø±ÙŠØ±ÙŠØ¬</option><option>Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³</option><option>Ø§Ù„Ø·Ø§Ø±Ù</option>
          <option>ØªÙ†Ø¯ÙˆÙ</option><option>ØªÙŠØ³Ù…Ø³ÙŠÙ„Øª</option><option>Ø§Ù„ÙˆØ§Ø¯ÙŠ</option><option>Ø®Ù†Ø´Ù„Ø©</option>
          <option>Ø³ÙˆÙ‚ Ø£Ù‡Ø±Ø§Ø³</option><option>ØªÙŠØ¨Ø§Ø²Ø©</option><option>Ù…ÙŠÙ„Ø©</option><option>Ø¹ÙŠÙ† Ø§Ù„Ø¯ÙÙ„Ù‰</option>
          <option>Ø§Ù„Ù†Ø¹Ø§Ù…Ø©</option><option>Ø¹ÙŠÙ† ØªÙŠÙ…ÙˆØ´Ù†Øª</option><option>ØºØ±Ø¯Ø§ÙŠØ©</option><option>ØºÙ„ÙŠØ²Ø§Ù†</option>
          <option>ØªÙŠÙ…ÙŠÙ…ÙˆÙ†</option><option>Ø¨Ø±Ø¬ Ø¨Ø§Ø¬ÙŠ Ù…Ø®ØªØ§Ø±</option><option>Ø£ÙˆÙ„Ø§Ø¯ Ø¬Ù„Ø§Ù„</option><option>Ø¨Ù†ÙŠ Ø¹Ø¨Ø§Ø³</option>
          <option>Ø¹ÙŠÙ† ØµØ§Ù„Ø­</option><option>Ø¹ÙŠÙ† Ù‚Ø²Ø§Ù…</option><option>ØªÙ‚Ø±Øª</option><option>Ø¬Ø§Ù†Øª</option>
          <option>Ø§Ù„Ù…ØºÙŠØ±</option><option>Ø§Ù„Ù…Ù†ÙŠØ¹Ø©</option>
        </select>
      </div>
    </div>
    <div class="form-group"><label>Ø§Ù„ÙˆØµÙ *</label><textarea id="adDesc" placeholder="Ø§Ø´Ø±Ø­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†..."></textarea></div>
    <div class="form-group"><label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„ØªÙˆØ§ØµÙ„ *</label><input type="tel" id="adPhone" placeholder="0xxxxxxxxx"></div>
    <div class="form-group">
      <label>ØµÙˆØ± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø­ØªÙ‰ 5 ØµÙˆØ±)</label>
      <div class="img-upload" onclick="document.getElementById('imgInput').click()">
        <div style="font-size:28px">ğŸ“·</div>
        <p>Ø§Ø¶ØºØ· Ù„Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±</p>
        <input type="file" id="imgInput" accept="image/*" multiple onchange="previewImgs(event)">
      </div>
      <div class="img-previews" id="imgPreviews"></div>
    </div>
    <button class="btn btn-primary" style="width:100%;padding:13px;font-size:15px" onclick="submitAd()" id="submitBtn">ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
  </div>
</div>

<!-- AD DETAIL MODAL -->
<div class="modal-overlay" id="detailModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('detailModal')">âœ•</button>
    <div id="detailContent"></div>
  </div>
</div>

<!-- MY ADS MODAL -->
<div class="modal-overlay" id="myAdsModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('myAdsModal')">âœ•</button>
    <h2>ğŸ“‹ Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ</h2>
    <div id="myAdsList"><div class="loading"><div class="spinner"></div></div></div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, doc, deleteDoc, updateDoc, increment, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCyejRGX1nfr8vACwQeLUsa1kIshWwQZj4",
    authDomain: "market-algerie.firebaseapp.com",
    projectId: "market-algerie",
    storageBucket: "market-algerie.firebasestorage.app",
    messagingSenderId: "915670005616",
    appId: "1:915670005616:web:2b1caf265b0b4574cf01b5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const googleProvider = new GoogleAuthProvider();
  const IMGUR_CLIENT_ID = '546c25a59c58ad7';

  let currentUser = null;
  let allAds = [];
  let currentCat = 'all';
  let currentType = 'all';
  let selectedImgs = [];
  let displayCount = 12;
  let currentRating = 0;
  const PAGE_SIZE = 12;

  window.goHome = () => { showPage('homePage'); currentType = 'all'; };

  window.openCategory = (cat, icon) => {
    currentCat = cat; currentType = 'all'; displayCount = PAGE_SIZE;
    document.getElementById('catPageTitle').textContent = icon + ' ' + cat;
    document.getElementById('breadcrumbCat').textContent = cat;
    document.querySelectorAll('.filter-btn').forEach((b,i) => b.classList.toggle('active', i===0));
    showPage('categoryPage');
    renderCategoryAds();
  };

  const showPage = id => {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    window.scrollTo(0,0);
  };

  window.openModal = id => document.getElementById(id).classList.add('open');
  window.closeModal = id => document.getElementById(id).classList.remove('open');

  window.showToast = (msg, type='success') => {
    const t = document.getElementById('toast');
    t.textContent = msg; t.className = 'toast show ' + type;
    setTimeout(() => t.classList.remove('show'), 3000);
  };

  window.requireAuth = () => {
    if (!currentUser) { openModal('authModal'); showToast('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†','error'); }
    else openModal('postModal');
  };

  window.logout = async () => { await signOut(auth); showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬'); };

  window.switchAuthTab = tab => {
    document.querySelectorAll('.auth-tab').forEach((t,i) => t.classList.toggle('active',(tab==='login'&&i===0)||(tab==='register'&&i===1)));
    document.getElementById('loginForm').style.display = tab==='login'?'block':'none';
    document.getElementById('registerForm').style.display = tab==='register'?'block':'none';
  };

  window.doLogin = async () => {
    const email = document.getElementById('loginEmail').value.trim();
    const pass = document.getElementById('loginPass').value;
    if (!email||!pass) return showToast('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±','error');
    const btn = document.getElementById('loginBtn');
    btn.disabled=true; btn.textContent='Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
    try {
      await signInWithEmailAndPassword(auth,email,pass);
      closeModal('authModal'); showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! ğŸ‘‹');
    } catch(e) { showToast('Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø© Ø£Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯','error'); }
    btn.disabled=false; btn.textContent='Ø¯Ø®ÙˆÙ„';
  };

  window.doGoogleLogin = async () => {
    try { await signInWithPopup(auth,googleProvider); closeModal('authModal'); showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! ğŸ‘‹'); }
    catch(e) { showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google','error'); }
  };

  window.doRegister = async () => {
    const name=document.getElementById('regName').value.trim();
    const email=document.getElementById('regEmail').value.trim();
    const phone=document.getElementById('regPhone').value.trim();
    const pass=document.getElementById('regPass').value;
    if (!name||!email||!phone||!pass) return showToast('Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„','error');
    if (pass.length<6) return showToast('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„','error');
    const btn=document.getElementById('registerBtn');
    btn.disabled=true; btn.textContent='Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';
    try {
      const cred=await createUserWithEmailAndPassword(auth,email,pass);
      await updateProfile(cred.user,{displayName:name});
      await addDoc(collection(db,'users'),{uid:cred.user.uid,name,email,phone,createdAt:new Date()});
      closeModal('authModal'); showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
    } catch(e) {
      showToast(e.code==='auth/email-already-in-use'?'Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹':'Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰','error');
    }
    btn.disabled=false; btn.textContent='Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨';
  };

  onAuthStateChanged(auth, user => {
    currentUser = user;
    if (user) {
      document.getElementById('guestButtons').style.display='none';
      document.getElementById('userBadge').style.display='block';
      const name=user.displayName||user.email.split('@')[0];
      document.getElementById('userName').textContent=name;
      document.getElementById('userInitial').textContent=name.charAt(0).toUpperCase();
    } else {
      document.getElementById('guestButtons').style.display='flex';
      document.getElementById('userBadge').style.display='none';
    }
  });

  window.previewImgs = e => {
    selectedImgs=Array.from(e.target.files).slice(0,5);
    const container=document.getElementById('imgPreviews'); container.innerHTML='';
    selectedImgs.forEach((f,i)=>{
      const reader=new FileReader();
      reader.onload=ev=>{
        const div=document.createElement('div'); div.className='img-preview-item';
        div.innerHTML=`<img src="${ev.target.result}"><button onclick="removeImg(${i})">âœ•</button>`;
        container.appendChild(div);
      };
      reader.readAsDataURL(f);
    });
  };
  window.removeImg = i => { selectedImgs.splice(i,1); };

  window.submitAd = async () => {
    if (!currentUser) return showToast('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹','error');
    const title=document.getElementById('adTitle').value.trim();
    const cat=document.getElementById('adCat').value;
    const type=document.getElementById('adType').value;
    const price=document.getElementById('adPrice').value;
    const wilaya=document.getElementById('adWilaya').value;
    const desc=document.getElementById('adDesc').value.trim();
    const phone=document.getElementById('adPhone').value.trim();
    if (!title||!cat||!type||!wilaya||!desc||!phone) return showToast('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (*)','error');
    const btn=document.getElementById('submitBtn');
    btn.disabled=true; btn.textContent='â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...';
    try {
      let imgUrls=[];
      for (const img of selectedImgs) {
        try {
          const fd=new FormData(); fd.append('image',img);
          const res=await fetch('https://api.imgur.com/3/image',{method:'POST',headers:{'Authorization':'Client-ID '+IMGUR_CLIENT_ID},body:fd});
          const data=await res.json();
          if(data.success) imgUrls.push(data.data.link);
        } catch(ie){}
      }
      await addDoc(collection(db,'ads'),{
        title,cat,type,price:price||'Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙØ§ÙˆØ¶',wilaya,desc,phone,
        images:imgUrls,userId:currentUser.uid,
        userName:currentUser.displayName||'Ù…Ø³ØªØ®Ø¯Ù…',
        createdAt:new Date(),views:0,avgRating:0,ratingCount:0
      });
      closeModal('postModal'); showToast('âœ… ØªÙ… Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ø¨Ù†Ø¬Ø§Ø­!');
      ['adTitle','adPrice','adDesc','adPhone'].forEach(id=>document.getElementById(id).value='');
      ['adCat','adType','adWilaya'].forEach(id=>document.getElementById(id).value='');
      document.getElementById('imgPreviews').innerHTML='';
      selectedImgs=[];
      loadAds();
    } catch(e){ showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±','error'); }
    btn.disabled=false; btn.textContent='ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†';
  };

  const loadAds = async () => {
    try {
      const snap=await getDocs(query(collection(db,'ads'),orderBy('createdAt','desc'),limit(300)));
      allAds=snap.docs.map(d=>({id:d.id,...d.data()}));
      updateCounts(); updateStats();
      if(document.getElementById('categoryPage').classList.contains('active')) renderCategoryAds();
    } catch(e){ console.error(e); }
  };

  const updateCounts = () => {
    ['Ø³ÙŠØ§Ø±Ø§Øª','Ø¹Ù‚Ø§Ø±Ø§Øª','Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª','Ù…Ù„Ø§Ø¨Ø³','ÙˆØ¸Ø§Ø¦Ù','Ø£Ø«Ø§Ø«','Ø¯Ø±Ø§Ø¬Ø§Øª','Ø®Ø¯Ù…Ø§Øª','Ø­ÙŠÙˆØ§Ù†Ø§Øª','Ø±ÙŠØ§Ø¶Ø©','Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©','Ø£Ø®Ø±Ù‰'].forEach(c=>{
      const el=document.getElementById('cnt-'+c);
      if(el) el.textContent=allAds.filter(a=>a.cat===c).length+' Ø¥Ø¹Ù„Ø§Ù†';
    });
  };

  const updateStats = async () => {
    document.getElementById('statAds').textContent=allAds.length+'+';
    try {
      const s=await getDocs(collection(db,'users'));
      document.getElementById('statUsers').textContent=(s.size||1)+'+';
    } catch(e){ document.getElementById('statUsers').textContent='1+'; }
  };

  const catIcons={Ø³ÙŠØ§Ø±Ø§Øª:'ğŸš—',Ø¹Ù‚Ø§Ø±Ø§Øª:'ğŸ ',Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª:'ğŸ“±',Ù…Ù„Ø§Ø¨Ø³:'ğŸ‘—',ÙˆØ¸Ø§Ø¦Ù:'ğŸ’¼',Ø£Ø«Ø§Ø«:'ğŸ›‹ï¸',Ø¯Ø±Ø§Ø¬Ø§Øª:'ğŸï¸',Ø®Ø¯Ù…Ø§Øª:'ğŸ”§',Ø­ÙŠÙˆØ§Ù†Ø§Øª:'ğŸ¾',Ø±ÙŠØ§Ø¶Ø©:'âš½','Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©':'ğŸ¡',Ø£Ø®Ø±Ù‰:'ğŸ“¦'};
  const typeClass={'Ù„Ù„Ø¨ÙŠØ¹':'type-sell','Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±':'type-rent','Ù…Ø·Ù„ÙˆØ¨':'type-wanted','Ù…Ø¬Ø§Ù†ÙŠ':'type-free'};

  const timeAgo = d => {
    if(!d) return '';
    const sec=Math.floor((new Date()-(d.toDate?d.toDate():new Date(d)))/1000);
    if(sec<60) return 'Ø§Ù„Ø¢Ù†';
    if(sec<3600) return Math.floor(sec/60)+' Ø¯Ù‚ÙŠÙ‚Ø©';
    if(sec<86400) return Math.floor(sec/3600)+' Ø³Ø§Ø¹Ø©';
    return Math.floor(sec/86400)+' ÙŠÙˆÙ…';
  };

  const starsHtml = (avg,count) => {
    const full=Math.round(avg||0); let s='';
    for(let i=1;i<=5;i++) s+=`<span class="star-sm ${i<=full?'':'empty'}">â˜…</span>`;
    return `<div class="rating-display">${s}<span style="font-size:10px;color:var(--text-muted);margin-right:4px">(${count||0})</span></div>`;
  };

  const adCardHtml = (ad,i) => `
    <div class="ad-card" style="animation-delay:${i*0.05}s" onclick="openDetail('${ad.id}')">
      <div class="ad-img">
        ${ad.images&&ad.images[0]?`<img src="${ad.images[0]}" loading="lazy" alt="${ad.title}">`:(catIcons[ad.cat]||'ğŸ“¦')}
        ${ad.avgRating>0?`<div class="ad-rating-badge">â­ ${Number(ad.avgRating).toFixed(1)}</div>`:''}
      </div>
      <div class="ad-body">
        <span class="ad-type ${typeClass[ad.type]||'type-sell'}">${ad.type}</span>
        <div class="ad-title">${ad.title}</div>
        <div class="ad-price">${ad.price==='Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙØ§ÙˆØ¶'?'Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙØ§ÙˆØ¶':Number(ad.price).toLocaleString()+' Ø¯Ø¬'}</div>
        ${starsHtml(ad.avgRating,ad.ratingCount)}
        <div class="ad-meta" style="margin-top:6px"><span>ğŸ“ ${ad.wilaya}</span><span>ğŸ• ${timeAgo(ad.createdAt)}</span></div>
      </div>
    </div>`;

  const renderCategoryAds = () => {
    let ads=allAds.filter(a=>a.cat===currentCat);
    if(currentType!=='all') ads=ads.filter(a=>a.type===currentType);
    const grid=document.getElementById('adsGrid');
    if(!ads.length){
      grid.innerHTML=`<div class="empty-state"><div class="icon">ğŸ“­</div><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙÙŠ ${currentCat}</h3><p>ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙ†Ø´Ø± ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©!</p><button class="btn btn-primary" onclick="requireAuth()" style="margin-top:12px">+ Ø£Ø¶Ù Ø¥Ø¹Ù„Ø§Ù†</button></div>`;
      document.getElementById('loadMoreBtn').style.display='none'; return;
    }
    grid.innerHTML=ads.slice(0,displayCount).map((ad,i)=>adCardHtml(ad,i)).join('');
    document.getElementById('loadMoreBtn').style.display=ads.length>displayCount?'inline-block':'none';
  };

  window.loadMore = () => { displayCount+=PAGE_SIZE; renderCategoryAds(); };

  window.filterType = (type,el) => {
    currentType=type; displayCount=PAGE_SIZE;
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    el.classList.add('active'); renderCategoryAds();
  };

  window.doSearch = () => {
    const q=document.getElementById('searchInput').value.trim();
    if(!q) return;
    const results=allAds.filter(a=>a.title.includes(q)||a.desc.includes(q)||a.wilaya.includes(q)||a.cat.includes(q));
    showPage('searchPage');
    const grid=document.getElementById('searchGrid');
    grid.innerHTML=results.length
      ? results.map((ad,i)=>adCardHtml(ad,i)).join('')
      : `<div class="empty-state"><div class="icon">ğŸ”</div><h3>Ù„Ø§ Ù†ØªØ§Ø¦Ø¬ Ù„Ù€ "${q}"</h3><p>Ø¬Ø±Ø¨ ÙƒÙ„Ù…Ø© Ø¨Ø­Ø« Ø£Ø®Ø±Ù‰</p></div>`;
  };

  window.openDetail = async id => {
    const ad=allAds.find(a=>a.id===id);
    if(!ad) return;
    currentRating=0;
    document.getElementById('detailContent').innerHTML=`
      <div class="ad-detail-img-main">${ad.images&&ad.images[0]?`<img src="${ad.images[0]}" alt="${ad.title}">`:(catIcons[ad.cat]||'ğŸ“¦')}</div>
      ${ad.images&&ad.images.length>1?`<div style="display:grid;grid-template-columns:repeat(${Math.min(ad.images.length-1,3)},1fr);gap:6px;margin-bottom:12px">${ad.images.slice(1).map(u=>`<div style="height:70px;border-radius:8px;overflow:hidden"><img src="${u}" style="width:100%;height:100%;object-fit:cover"></div>`).join('')}</div>`:''}
      <span class="ad-type ${typeClass[ad.type]||'type-sell'}" style="margin-bottom:10px;display:inline-block">${ad.type}</span>
      <h3 style="font-size:18px;font-weight:800;margin-bottom:8px">${ad.title}</h3>
      <div style="font-size:22px;font-weight:900;color:var(--orange);margin-bottom:12px">${ad.price==='Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙØ§ÙˆØ¶'?'Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙØ§ÙˆØ¶':Number(ad.price).toLocaleString()+' Ø¯Ø¬'}</div>
      <div class="detail-info">
        <div class="detail-row"><span class="label">Ø§Ù„ÙØ¦Ø©</span><span class="value">${catIcons[ad.cat]||''} ${ad.cat}</span></div>
        <div class="detail-row"><span class="label">Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</span><span class="value">ğŸ“ ${ad.wilaya}</span></div>
        <div class="detail-row"><span class="label">Ø§Ù„Ø¨Ø§Ø¦Ø¹</span><span class="value">ğŸ‘¤ ${ad.userName}</span></div>
        <div class="detail-row"><span class="label">Ø§Ù„ØªØ§Ø±ÙŠØ®</span><span class="value">ğŸ• ${timeAgo(ad.createdAt)}</span></div>
        <div class="detail-row"><span class="label">Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</span><span class="value">ğŸ‘ï¸ ${(ad.views||0)+1}</span></div>
        <div class="detail-row"><span class="label">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span><span class="value">${starsHtml(ad.avgRating,ad.ratingCount)}</span></div>
      </div>
      <div style="font-size:13px;color:var(--text-muted);line-height:1.8;margin-bottom:14px">${ad.desc}</div>
      <button class="contact-btn" onclick="window.open('https://wa.me/213${ad.phone.replace(/^0/,'')}?text=Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ø±Ø£ÙŠØª Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ø¹Ù„Ù‰ Algerie-Market: ${encodeURIComponent(ad.title)}','_blank')">
        <span>ğŸ“±</span> ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ - ${ad.phone}
      </button>
      <a href="tel:${ad.phone}" style="display:block;text-align:center;padding:12px;border:1px solid var(--border);border-radius:12px;color:var(--text);text-decoration:none;font-weight:700;font-size:14px;margin-top:8px">
        ğŸ“ Ø§ØªØµØ§Ù„ Ù…Ø¨Ø§Ø´Ø±: ${ad.phone}
      </a>
      <div style="margin-top:20px;background:var(--dark3);border-radius:12px;padding:14px">
        <div style="font-size:13px;font-weight:700;margin-bottom:10px">â­ Ù‚ÙŠÙ‘Ù… Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</div>
        ${currentUser?`
          <div class="stars-row" id="starRow">
            <span class="star" onclick="setRating(1,'${id}')" onmouseover="hoverRating(1)" onmouseout="resetHover()">â˜…</span>
            <span class="star" onclick="setRating(2,'${id}')" onmouseover="hoverRating(2)" onmouseout="resetHover()">â˜…</span>
            <span class="star" onclick="setRating(3,'${id}')" onmouseover="hoverRating(3)" onmouseout="resetHover()">â˜…</span>
            <span class="star" onclick="setRating(4,'${id}')" onmouseover="hoverRating(4)" onmouseout="resetHover()">â˜…</span>
            <span class="star" onclick="setRating(5,'${id}')" onmouseover="hoverRating(5)" onmouseout="resetHover()">â˜…</span>
          </div>
          <div id="ratingStatus" style="font-size:11px;color:var(--text-muted);margin-top:6px">Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø¬ÙˆÙ… Ù„Ù„ØªÙ‚ÙŠÙŠÙ…</div>
        `:`<div style="font-size:12px;color:var(--text-muted)">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</div>`}
      </div>
      <div class="comments-section">
        <h4>ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h4>
        <div id="commentsList"><div class="comments-loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª...</div></div>
        ${currentUser?`
          <div class="add-comment-box">
            <div style="font-size:12px;font-weight:700;color:var(--text-muted);margin-bottom:6px">Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹</div>
            <div class="comment-input-row">
              <input type="text" id="commentInput" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§...">
              <button onclick="submitComment('${id}')">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
          </div>
        `:`<div style="font-size:12px;color:var(--text-muted);margin-top:8px;text-align:center">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</div>`}
      </div>`;
    openModal('detailModal');
    try { await updateDoc(doc(db,'ads',id),{views:increment(1)}); } catch(e){}
    loadComments(id);
  };

  window.hoverRating = n => {
    document.querySelectorAll('#starRow .star').forEach((s,i) => { s.style.color=i<n?'var(--gold)':'#444'; });
  };
  window.resetHover = () => {
    document.querySelectorAll('#starRow .star').forEach((s,i) => { s.style.color=i<currentRating?'var(--gold)':'#444'; });
  };

  window.setRating = async (n,adId) => {
    if(!currentUser) return showToast('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹','error');
    currentRating=n;
    resetHover();
    document.getElementById('ratingStatus').textContent='â³ Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ ØªÙ‚ÙŠÙŠÙ…Ùƒ...';
    try {
      const allRatingsSnap=await getDocs(query(collection(db,'ratings'),where('adId','==',adId)));
      const allRatingDocs=allRatingsSnap.docs;
      const existingDoc=allRatingDocs.find(d=>d.data().userId===currentUser.uid);
      if(existingDoc) {
        await updateDoc(doc(db,'ratings',existingDoc.id),{rating:n,updatedAt:new Date()});
      } else {
        await addDoc(collection(db,'ratings'),{adId,userId:currentUser.uid,rating:n,createdAt:new Date()});
      }
      const updatedRatings=allRatingDocs.filter(d=>d.data().userId!==currentUser.uid).map(d=>d.data().rating);
      updatedRatings.push(n);
      const avg=updatedRatings.reduce((a,b)=>a+b,0)/updatedRatings.length;
      await updateDoc(doc(db,'ads',adId),{avgRating:avg,ratingCount:updatedRatings.length});
      const localAd=allAds.find(a=>a.id===adId);
      if(localAd){localAd.avgRating=avg;localAd.ratingCount=updatedRatings.length;}
      document.getElementById('ratingStatus').textContent=`âœ… ØªÙ… ØªÙ‚ÙŠÙŠÙ…Ùƒ Ø¨Ù€ ${n} Ù†Ø¬Ù…Ø©`;
      showToast(`Ø´ÙƒØ±Ø§Ù‹! Ù‚ÙŠÙ‘Ù…Øª Ø¨Ù€ ${n} Ù†Ø¬ÙˆÙ… â­`);
    } catch(e){ document.getElementById('ratingStatus').textContent='Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰'; console.error(e); }
  };

  const loadComments = async adId => {
    const list=document.getElementById('commentsList');
    if(!list) return;
    try {
      const snap=await getDocs(query(collection(db,'comments'),where('adId','==',adId),limit(50)));
      if(snap.empty){ list.innerHTML='<div class="no-comments">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯ØŒ ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¹Ù„Ù‚!</div>'; return; }
      const comments=snap.docs.map(d=>({id:d.id,...d.data()}));
      comments.sort((a,b)=>{
        const ta=a.createdAt?.toDate?a.createdAt.toDate():new Date(a.createdAt||0);
        const tb=b.createdAt?.toDate?b.createdAt.toDate():new Date(b.createdAt||0);
        return tb-ta;
      });
      list.innerHTML=comments.map(c=>`
        <div class="comment-item">
          <div class="comment-header">
            <span class="comment-author">ğŸ‘¤ ${c.userName}</span>
            <span class="comment-time">${timeAgo(c.createdAt)}</span>
          </div>
          ${c.rating?`<div class="comment-stars">${'â˜…'.repeat(c.rating)}<span style="color:#444">${'â˜…'.repeat(5-c.rating)}</span></div>`:''}
          <div class="comment-text">${c.text}</div>
        </div>`).join('');
    } catch(e){ list.innerHTML='<div class="no-comments">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</div>'; console.error(e); }
  };

  window.submitComment = async adId => {
    if(!currentUser) return showToast('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹','error');
    const input=document.getElementById('commentInput');
    const text=input.value.trim();
    if(!text||text.length<3) return showToast('Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹','error');
    input.disabled=true;
    try {
      await addDoc(collection(db,'comments'),{
        adId,text,userId:currentUser.uid,
        userName:currentUser.displayName||'Ù…Ø³ØªØ®Ø¯Ù…',
        rating:currentRating||0,createdAt:new Date()
      });
      input.value='';
      showToast('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚Ùƒ!');
      loadComments(adId);
    } catch(e){ showToast('Ø­Ø¯Ø« Ø®Ø·Ø£','error'); }
    input.disabled=false;
  };

  window.openMyAds = async () => {
    if(!currentUser) return;
    openModal('myAdsModal');
    const list=document.getElementById('myAdsList');
    list.innerHTML='<div class="loading"><div class="spinner"></div></div>';
    const myAds=allAds.filter(a=>a.userId===currentUser.uid);
    if(!myAds.length){ list.innerHTML='<div class="empty-state"><div class="icon">ğŸ“­</div><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h3><p>Ø§Ù†Ø´Ø± Ø£ÙˆÙ„ Ø¥Ø¹Ù„Ø§Ù† Ù„Ùƒ!</p></div>'; return; }
    list.innerHTML=myAds.map(ad=>`
      <div class="my-ad-item">
        <div class="my-ad-thumb">${ad.images&&ad.images[0]?`<img src="${ad.images[0]}" alt="">`:(catIcons[ad.cat]||'ğŸ“¦')}</div>
        <div class="my-ad-info">
          <div class="my-ad-title">${ad.title}</div>
          <div class="my-ad-price">${ad.price==='Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙØ§ÙˆØ¶'?'Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙØ§ÙˆØ¶':Number(ad.price).toLocaleString()+' Ø¯Ø¬'}</div>
          <div style="font-size:10px;color:var(--text-muted)">ğŸ“ ${ad.wilaya} â€¢ ğŸ‘ï¸ ${ad.views||0} â€¢ â­ ${(ad.avgRating||0).toFixed(1)} (${ad.ratingCount||0})</div>
        </div>
        <div><button class="btn-delete" onclick="deleteMyAd('${ad.id}',this)">Ø­Ø°Ù</button></div>
      </div>`).join('');
  };

  window.deleteMyAd = async (id,btn) => {
    if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ')) return;
    btn.textContent='...';
    try {
      await deleteDoc(doc(db,'ads',id));
      allAds=allAds.filter(a=>a.id!==id);
      updateCounts(); openMyAds(); showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†');
    } catch(e){ showToast('Ø­Ø¯Ø« Ø®Ø·Ø£','error'); }
  };

  loadAds();
</script>
</body>
</html>
